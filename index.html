<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Solicitud de Alta de VPN – 2 Hojas</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Libre+Franklin:wght@500;700&display=swap" rel="stylesheet">

  <style>
    *{box-sizing:border-box}
    body{margin:0;background:#f3f5f8;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}

    /* === HOJA A4 EXACTA === */
    .sheet{
      width:210mm;
      height:297mm;         /* 1 hoja exacta */
      padding:8mm;
      background:#fff;
      border:2px solid #1a1a1a;
      margin:5mm auto;      /* solo vista en pantalla */
      overflow:hidden;      /* recorta cualquier sobrante */
      page-break-inside:avoid;
    }

    .header-wrap{border:1.6px solid #343a40;border-radius:6px;overflow:hidden;background:#f2f5f9}
    .header{display:grid;grid-template-columns:200px 1fr;align-items:center}
    .logo-column{border-right:1.6px solid #343a40;padding:8px;display:flex;align-items:center;justify-content:center}
    .logo-img{max-height:70px;width:auto;object-fit:contain;display:block}
    .title-column{text-align:center;padding:16px 8px}
    .title-main{font-family:"Libre Franklin",Inter,sans-serif;font-weight:700;font-size:22px}
    .title-sub{margin-top:4px;font-weight:600;font-size:14px}

    .bar-box{margin-top:6mm;border:1.4px solid #343a40;border-radius:6px;overflow:hidden}
    .bar{display:grid;grid-template-columns:auto 1fr}
    .bar-label{padding:6px 10px;background:#e9eef6;font-weight:700;border-right:1.4px solid #343a40}
    .bar-fill{background:#fff}

    table.grid{width:100%;border-collapse:collapse;border-spacing:0}
    table.grid th,table.grid td{border:1px solid #343a40;padding:6px 7px;font-size:12.6px}
    table.grid th{background:#f0f3f8;text-align:left;font-weight:600}

    .input-line{width:100%;border:none;border-bottom:1px dashed #7e8790;padding:2px 0;font:inherit;outline:none;background:transparent}
    input[type="date"], textarea{width:100%;border:1px solid #cfd6df;padding:6px 8px;border-radius:4px;font:inherit;resize:vertical}

    .req{color:#c1121f;font-weight:700}
    .invalid{outline:2px solid #c1121f !important; background:#fff2f2}

    /* SISTEMAS */
    .checks-wrap{padding:10px}
    .checks-grid{display:grid;gap:12px;grid-template-columns:1fr 45%;align-items:start}
    .checks-left{display:grid;gap:8px}
    .check{display:grid;grid-template-columns:16px 1fr;gap:8px;align-items:center}
    .check input.cb{appearance:none;width:14px;height:14px;margin:0;cursor:pointer;border:1.4px solid #343a40;border-radius:2px;background:#fff}
    .check input.cb:checked{background:#0067c6}
    .hint{color:#444;font-size:12px}
    .details-box label{display:block;margin-bottom:6px;font-size:12px;color:#333}
    .details-box textarea{min-height:92px}
    .details-box textarea:disabled{background:#f5f5f5; color:#777; cursor:not-allowed}
    @media (max-width:1000px){.checks-grid{grid-template-columns:1fr}}

    .notice{margin-top:4mm;border:1px solid #000;border-radius:4px;padding:0 4mm 3mm}
    .notice-head{background:#000;color:#fff;text-align:center;font-weight:700;padding:3mm 2mm;margin:-1px -1px 3mm -1px;border-radius:4px 4px 0 0;font-size:12.5px;letter-spacing:.3px}
    .notice-list{margin:0 0 0 18px;padding:0;font-size:12px}
    .notice-list li{margin:2mm 0;line-height:1.35}
    .notice a{color:#0a58ca;text-decoration:underline}

    #instructivo{display:flex;flex-direction:column}
    #instructivo .inst-body{flex:1;display:flex;flex-direction:column}
    #instructivo .footbox{margin-top:auto}
    .hlead{font-weight:700;text-transform:uppercase;font-size:13px;margin:10px 0 8px 0}
    ol.inst{margin:6px 0 0 16px;padding:0 8px}
    ol.inst li{margin:4px 0;line-height:1.35}
    .note{font-size:11px;color:#222}
    .footbox{border-top:2px solid #000;margin-top:10mm;padding-top:3mm;font-size:11px}

    .toolbar{position:sticky;top:0;z-index:10;display:flex;gap:8px;justify-content:center;padding:10px 0;background:transparent}
    .btn{background:#0067c6;color:#fff;border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer;box-shadow:0 4px 16px rgba(0,103,198,.25)}
    .btn.secondary{background:#6c757d}

    @media print{
      @page { margin: 0; }
      .toolbar{display:none!important}
      .sheet{margin:0 auto;border:2px solid #1a1a1a}
    }

    /* === Ajustes de ancho: E-Mail largo y Teléfono compacto === */
    #tblSolicitante{table-layout: fixed;}
    #tblSolicitante th, #tblSolicitante td{white-space: normal;word-break: break-word;}
    #tblSolicitante td:nth-child(4) input{max-width: 35mm;}
    #tblSolicitante input[type="number"][inputmode="numeric"]{max-width: 35mm;}
  </style>
</head>
<body>
  
  <div class="toolbar">
    <button id="btnPdf" class="btn">Convertir a PDF</button>
    <button id="btnClear" class="btn secondary">Limpiar Formulario</button>
  </div>

  <div id="doc">
    <!-- ===== HOJA 1 ===== -->
    <section id="hoja1" class="sheet">
      <div class="header-wrap">
        <div class="header">
          <div class="logo-column">
            <img class="logo-img" src="./logo-para-VPN.png" alt="" crossorigin="anonymous">
          </div>
          <div class="title-column">
            <div class="title-main">Seguridad Informática</div>
            <div class="title-sub">Ministerio de Seguridad - CABA</div>
          </div>
        </div>
      </div>

      <div class="bar-box">
        <div class="bar"><div class="bar-label">DATOS DE LA SOLICITUD</div><div class="bar-fill"></div></div>
        <table class="grid">
          <tr>
            <th>Fecha de Solicitud</th>
            <td><input id="fechaSolicitud" type="date" placeholder="dd/mm/aaaa" required></td>
            <th>Referido a CCOO</th>
            <td><input class="input-line" type="text" placeholder="NO-AAAA-xxxxx-GCABA-XX"></td>
          </tr>
        </table>
      </div>

      <div class="bar-box">
        <div class="bar"><div class="bar-label">DATOS DEL SOLICITANTE</div><div class="bar-fill"></div></div>
        <table id="tblSolicitante" class="grid">
          <colgroup>
            <col style="width:16%">
            <col style="width:50%">
            <col style="width:16%">
            <col style="width:14%">
          </colgroup>
          <tr>
            <th><span class="req">Apellido y Nombre</span></th>
            <td colspan="3">
              <input id="inpNombre" class="input-line" type="text" required
               pattern="^[A-Za-zÁÉÍÓÚÜÑáéíóúüñ\s']+$"
               title="Ingrese solo letras y espacios"
               oninput="this.value = this.value.replace(/[^A-Za-zÁÉÍÓÚÜÑáéíóúüñ\s']/g, '')">
            </td>
          </tr>
          <tr>
            <th>Usuario de Dominio</th>
            <td><input class="input-line" type="text"></td>
            <th><span class="req">Nº de CUIL</span></th>
            <td>
              <input id="inpCuil" class="input-line" type="text" inputmode="numeric" maxlength="11" required oninput="this.value=this.value.replace(/\D/g,'').slice(0,11)" pattern="^\d{11}$" title="11 dígitos sin guiones">
            </td>
          </tr>
          <tr>
            <th>Cargo</th>
            <td><input class="input-line" type="text"></td>
            <th>LP Nº</th>
            <td><input class="input-line" type="number" min="0" step="1"></td>
          </tr>
          <tr>
            <th>División / Departamento</th>
            <td colspan="3"><input class="input-line" type="text"></td>
          </tr>
          <tr>
            <th>Dependencia</th>
            <td colspan="3"><input class="input-line" type="text"></td>
          </tr>
          <tr>
            <th><span class="req">Calle</span></th>
            <td><input id="inpCalle" class="input-line" type="text" required></td>
            <th><span class="req">Nº</span></th>
            <td>
              <input id="inpNumero" class="input-line" type="number" inputmode="numeric" maxlength="5" required oninput="this.value=this.value.replace(/\D/g,'').slice(0,5)" pattern="^\d{5}$" title="5 dígitos sin guiones">
            </td>
          </tr>
          <tr>
            <th>E-Mail/Oficial</th>
            <td>
             <!-- E-Mail del SOLICITANTE -->
              <input id="emailSolic" class="input-line" type="email" required data-mail-inst
              placeholder="Caso de no tener correo oficial/Solicitarlo"
              pattern="^[a-zA-Z0-9._%+-]+@(buenosaires\.gob\.ar|policiadelaciudad\.gob\.ar|seguridadciudad\.gob\.ar)$"
              title="Debe usar @buenosaires.gob.ar, @policiadelaciudad.gob.ar o @seguridadciudad.gob.ar">


            </td>
            <th>Teléfono / Interno</th>
            <td>
              <input id="telSolic" class="input-line" type="text" inputmode="numeric" autocomplete="tel"
              maxlength="10" pattern="^\d{10}$" title="Ingrese exactamente 10 dígitos"
              oninput="this.value=this.value.replace(/\D/g,'').slice(0,10)">
            </td>

          </tr>
        </table>
      </div>

      <div class="bar-box">
        <div class="bar"><div class="bar-label">SISTEMAS O SERVIDORES A ACCEDER POR VPN</div><div class="bar-fill"></div></div>
        <div class="checks-wrap">
          <div class="checks-grid">
            <div class="checks-left">
              <label class="check"><input class="cb" type="checkbox"><span>Servicios Policiales <span class="hint">(SIRHU, SILOL, SMLAM, SIGET, SIGENO, SIFOR, CREA, GAP, etc.)</span></span></label>
              <label class="check"><input class="cb" type="checkbox"><span>Servicios ASI <span class="hint">(SADE, SIGAF, SIGAFWEB, BAC, etc.)</span></span></label>
              <label class="check"><input class="cb" type="checkbox"><span>SISEP</span></label>
              <label class="check"><input class="cb" type="checkbox"><span>Cámaras ULTRA-IP</span></label>
              <label class="check"><input class="cb" type="checkbox"><span>Carpeta Compartida</span></label>
              <label class="check"><input id="cbOtros" class="cb" type="checkbox"><span>Otros</span></label>
            </div>
            <div class="details-box">
              <label for="txOtros">Detalles adicionales</label>
              <!-- Arranca deshabilitado; se habilita al tildar "Otros" -->
              <textarea id="txOtros" rows="6" placeholder="Describa sistemas/servidores adicionales a requerir" disabled></textarea>
            </div>
          </div>
        </div>
      </div>

      <div class="bar-box">
        <div class="bar"><div class="bar-label">RESPONSABLE DE LA DEPENDENCIA</div><div class="bar-fill"></div></div>
        <table class="grid">
          <tr>
            <th><span class="req">Apellido y Nombre</span></th>
            <td colspan="3">
              <input id="respNombre" class="input-line" type="text" required
                     pattern="^[A-Za-zÁÉÍÓÚÜÑáéíóúüñ\s']+$"
                     title="Ingrese solo letras y espacios">
            </td>
          </tr>
          <tr>
            <th><span class="req">Cargo</span></th>
            <td><input id="respCargo" class="input-line" type="text" required></td>
            <th><span class="req">LP</span></th>
            <td><input id="respLP" class="input-line" type="text" inputmode="numeric" required></td>
          </tr>
          <tr>
            <th><span class="req">División / Departamento</span></th>
            <td colspan="3"><input id="respDivision" class="input-line" type="text" required></td>
          </tr>
          <tr>
            <th>E-Mail/Oficial</th>
            <td>
              <input id="emailResp" class="input-line" type="email" required data-mail-inst
              pattern="^[a-zA-Z0-9._%+-]+@(buenosaires\.gob\.ar|policiadelaciudad\.gob\.ar|seguridadciudad\.gob\.ar)$"
              title="Debe usar @buenosaires.gob.ar, @policiadelaciudad.gob.ar o @seguridadciudad.gob.ar">

            </td>
            <th>Teléfono / Interno</th>
            <td>
              <input id="telSolic" class="input-line" type="text" inputmode="numeric" autocomplete="tel"
              maxlength="10" pattern="^\d{10}$" title="Ingrese exactamente 10 dígitos"
              oninput="this.value=this.value.replace(/\D/g,'').slice(0,10)">
            </td>

          </tr>
        </table>
      </div>

      <div class="notice">
        <div class="notice-head">AVISO IMPORTANTE</div>
        <ol class="notice-list">
          <li>Al finalizar de completar el formulario, recuerde enviarlo vía CCOO a Jonatan PALUMBO (JPALUMBO).</li>
          <li>Ante cualquier duda comuníquese vía mail a <a href="mailto:soportemjys@buenosaires.gob.ar">soportemjys@buenosaires.gob.ar</a> o al teléfono: 4309-9800 int 115151.</li>
        </ol>
      </div>
    </section>

    <!-- ===== HOJA 2 (Instructivo) ===== -->
    <section id="instructivo" class="sheet">
      <div class="header-wrap">
        <div class="header">
          <div class="logo-column">
            <img class="logo-img" src="./logo-para-VPN.png" alt="" crossorigin="anonymous">
          </div>
          <div class="title-column">
            <div class="title-main">Seguridad Informática</div>
            <div class="title-sub">Ministerio de Seguridad - CABA</div>
          </div>
        </div>
      </div>

      <div class="hlead">INSTRUCCIONES PARA LA CONFECCIÓN DEL FORMULARIO DE SOLICITUD DE VPN</div>

      <div class="inst-body">
        <ol class="inst">
          <li>Los campos en <strong>rojo</strong> son obligatorios. De no completarse, se descartará el formulario.</li>
          <li>Completar la <strong>Fecha de Requerimiento</strong>.</li>
          <li>Indicar el <strong>Nº de CCOO</strong> de referencia. Ej.: <em>NO-2022-xxxxxxx-GCABA-SS</em>.</li>
          <li>Nombre completo del solicitante.</li>
          <li>Usuario de Dominio (usuario con el que ingresa a la PC de la dependencia).</li>
          <li><strong>No se puede prestar ni compartir</strong> la cuenta de usuario.
            <div class="note">Deberá solicitar el <strong>Área de Dominio</strong> al siguiente correo: <em>dominio.mjyseg@buenosaires.gob.ar</em></div>
          </li>
          <li>Indicar <strong>Nº de CUIL</strong> (sin guiones).</li>
          <li>Indicar <strong>LP del Solicitante</strong> (Personal contratado no completa).</li>
          <li>Indicar el <strong>e-mail</strong> del solicitante (<em>usuario@buenosaires.gob.ar</em>).
            <div class="note">En caso de no poseer, <strong>realizar la solicitud</strong> correspondiente (ver Intranet).</div>
          </li>
          <li>Indicar <strong>Teléfono o Interno</strong>.</li>
          <li>Indicar <strong>Sistemas o servidores</strong> a los cuales accederá por VPN.
            <div class="note">Puede elegir varias opciones. Carpeta Compartida solo si posee acceso; si requiere nuevo acceso, solicitarlo al Área de Dominio: <em>dominio.mjyseg@buenosaires.gob.ar</em></div>
          </li>
        </ol>
      </div>
    </section>
  </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
<script>
  function setTodayIfEmpty() {
    const dateInput = document.querySelector('#hoja1 input[type="date"]');
    if (!dateInput) return;
    const d = new Date();
    const pad = n => String(n).padStart(2,'0');
    const y = d.getFullYear(), m = pad(d.getMonth()+1), day = pad(d.getDate());
    if (!dateInput.value) dateInput.value = `${y}-${m}-${day}`;
  }
  document.addEventListener('DOMContentLoaded', setTodayIfEmpty);

  // ====== VALIDACIÓN DE DOMINIOS DE E-MAIL ======
  const allowedDomains = new Set([
  "buenosaires.gob.ar",
  "policiadelaciudad.gob.ar",
  "seguridadciudad.gob.ar"
]);

function isAllowedEmail(email){
  if(!email) return false;
  const at = email.indexOf("@");
  if (at === -1) return false;
  const domain = email.slice(at+1).toLowerCase().trim();
  return allowedDomains.has(domain);
}

function attachLiveEmailValidation(el){
  if(!el) return;
  el.addEventListener("input", () => {
    const v = el.value.trim();
    if (v && !isAllowedEmail(v)) {
      el.setCustomValidity("El correo debe ser institucional: @buenosaires.gob.ar, @policiadelaciudad.gob.ar o @seguridadciudad.gob.ar");
    } else {
      el.setCustomValidity("");
    }
  });
}

// Aplica a todos los e-mails institucionales (solicitante y responsable)
const emailInputs = Array.from(document.querySelectorAll('input[type="email"][data-mail-inst]'));
emailInputs.forEach(attachLiveEmailValidation);

  const emailSolic = document.getElementById('emailSolic');
  const emailResp  = document.getElementById('emailResp');
  attachLiveEmailValidation(emailSolic);
  attachLiveEmailValidation(emailResp);

  // ====== “Otros” solo editable si está tildado ======
  const cbOtros = document.getElementById('cbOtros');
  const txOtros = document.getElementById('txOtros');
  function syncOtros(){
    if (!cbOtros || !txOtros) return;
    txOtros.disabled = !cbOtros.checked;
    if (txOtros.disabled){
      txOtros.classList.remove('invalid');
      txOtros.value = '';
    }
  }
  if (cbOtros) {
    cbOtros.addEventListener('change', syncOtros);
    syncOtros(); // estado inicial
  }

function validarRequeridos(){
  let ok = true;

  // === Campos del solicitante (obligatorios) ===
  ['inpNombre','inpCuil','inpCalle','inpNumero','fechaSolicitud'].forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    el.classList.remove('invalid');
    if(!el.checkValidity()){
      el.classList.add('invalid');
      if(ok){ el.scrollIntoView({behavior:'smooth',block:'center'}); el.reportValidity?.(); el.focus(); }
      ok = false;
    }
  });

  // === “Otros” requiere detalle ===
  if(cbOtros && cbOtros.checked && txOtros && !txOtros.value.trim()){
    txOtros.classList.add('invalid');
    txOtros.scrollIntoView({behavior:'smooth',block:'center'});
    ok = false;
  } else if (txOtros){
    txOtros.classList.remove('invalid');
  }

  // === E-mails institucionales (Solicitante y Responsable) ===
  // Toma cualquier input email marcado con data-mail-inst, más #emailSolic/#emailResp por compatibilidad
  const emailNodeList = document.querySelectorAll(
    'input[type="email"][data-mail-inst], #emailSolic, #emailResp'
  );
  const emailInputs = Array.from(new Set(emailNodeList)); // dedup

  emailInputs.forEach(el=>{
    if(!el) return;
    el.classList.remove('invalid');
    const v = (el.value || '').trim();

    // si es required y está vacío -> error
    if (el.required && !v){
      el.setCustomValidity("Complete el e-mail institucional.");
      el.classList.add('invalid');
      if(ok){ el.scrollIntoView({behavior:'smooth',block:'center'}); el.reportValidity?.(); el.focus(); }
      ok = false;
      return;
    }

    // si hay valor y no es institucional -> error
    if (v && !isAllowedEmail(v)){
      el.setCustomValidity("El correo debe ser institucional: @buenosaires.gob.ar, @policiadelaciudad.gob.ar o @seguridadciudad.gob.ar");
      el.classList.add('invalid');
      if(ok){ el.scrollIntoView({behavior:'smooth',block:'center'}); el.reportValidity?.(); el.focus(); }
      ok = false;
    } else {
      el.setCustomValidity("");
    }
  });

  // === Campos del RESPONSABLE (obligatorios, e-mail ya validado arriba) ===
  ['respNombre','respCargo','respLP','respDivision','respTel'].forEach(id=>{
    const el = document.getElementById(id);
    if(!el) return;
    el.classList.remove('invalid');
    if(!el.checkValidity() || !String(el.value||'').trim()){
      el.classList.add('invalid');
      if(ok){ el.scrollIntoView({behavior:'smooth',block:'center'}); el.reportValidity?.(); el.focus(); }
      ok = false;
    }
  });

  return ok;
}



  // Carga un script si no existe (para jsPDF cuando el bundle no lo expone)
  function loadScript(src){
    return new Promise((resolve, reject)=>{
      const s = document.createElement('script');
      s.src = src; s.onload = resolve; s.onerror = reject;
      document.head.appendChild(s);
    });
  }

  // Renderiza un nodo a DataURL usando el html2canvas interno de html2pdf
  async function nodeToDataURL(el){
    const worker = html2pdf().set({
      margin: 0,
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: {
        backgroundColor: '#ffffff',
        scale: 2,
        useCORS: false,
        allowTaint: true,
        imageTimeout: 0,
        letterRendering: true,
        onclone: (doc)=>{
          // ocultar la toolbar en el clon
          const tb = doc.querySelector('.toolbar');
          if (tb) tb.style.display = 'none';

          // asegurar que cada hoja sea A4 exacta
          doc.querySelectorAll('.sheet').forEach(s=>{
            s.style.margin='0 auto';
            s.style.boxShadow='none';
            s.style.borderRadius='0';
            s.style.height='297mm';
            s.style.overflow='hidden';
            s.style.pageBreakInside='avoid';
          });

          /* ==== FIX FECHA: mostrar DD/MM/YYYY en el render del PDF ==== */
          const dateInputs = doc.querySelectorAll('input[type="date"]');
          dateInputs.forEach(inp=>{
            const iso = inp.value || '';
            let ddmmyyyy = iso;
            const m = /^(\d{4})-(\d{2})-(\d{2})$/.exec(iso);
            if (m) ddmmyyyy = `${m[3]}/${m[2]}/${m[1]}`;

            // reemplazar por input de texto "congelado" con el mismo look
            const txt = doc.createElement('input');
            txt.type = 'text';
            txt.value = ddmmyyyy;
            txt.readOnly = true;
            txt.className = inp.className;

            const cs = doc.defaultView.getComputedStyle(inp);
            txt.style.width         = cs.width;
            txt.style.padding       = cs.padding;
            txt.style.font          = cs.font;
            txt.style.background    = cs.backgroundColor;
            txt.style.borderTop     = `${cs.borderTopWidth} ${cs.borderTopStyle} ${cs.borderTopColor}`;
            txt.style.borderRight   = `${cs.borderRightWidth} ${cs.borderRightStyle} ${cs.borderRightColor}`;
            txt.style.borderBottom  = `${cs.borderBottomWidth} ${cs.borderBottomStyle} ${cs.borderBottomColor}`;
            txt.style.borderLeft    = `${cs.borderLeftWidth} ${cs.borderLeftStyle} ${cs.borderLeftColor}`;

            inp.parentNode.replaceChild(txt, inp);
          });
          /* ============================================================ */
        }
      },
      jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
    }).from(el).toCanvas();

    const canvas = await worker.get('canvas');
    return canvas.toDataURL('image/jpeg', 0.98);
  }

  document.getElementById('btnPdf').addEventListener('click', async ()=>{
    try { await document.fonts.ready; } catch(_) {}

    if(!validarRequeridos()){
      alert('Por favor complete los campos obligatorios, los datos del Responsable y/o corrija los e-mails institucionales.');
      return;
    }

    const hoja1 = document.getElementById('hoja1');
    const hoja2 = document.getElementById('instructivo');

    const cuil = (document.getElementById('inpCuil')?.value || '')
                  .replace(/\D/g,'').slice(0,11) || 'SIN-CUIL';

    try{
      const [img1, img2] = await Promise.all([nodeToDataURL(hoja1), nodeToDataURL(hoja2)]);

      let jsPDFCtor = (window.jspdf && (window.jspdf.jsPDF || window.jspdf.default)) || window.jsPDF;
      if (!jsPDFCtor){
        await loadScript('https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js');
        jsPDFCtor = window.jspdf && (window.jspdf.jsPDF || window.jspdf.default);
      }
      if (!jsPDFCtor) throw new Error('jsPDF no disponible');

      const pdf = new jsPDFCtor({ unit: 'mm', format: 'a4', orientation: 'portrait' });
      pdf.addImage(img1, 'JPEG', 0, 0, 210, 297, undefined, 'FAST');
      pdf.addPage();
      pdf.addImage(img2, 'JPEG', 0, 0, 210, 297, undefined, 'FAST');
      pdf.save(`Alta VPN - ${cuil}.pdf`);
    } catch (e){
      console.error(e);
      alert('No se pudo generar el PDF. Revisá la consola por detalles.');
    }
  });

  document.getElementById('btnClear').addEventListener('click', ()=>{
    document.querySelectorAll('#hoja1 input, #hoja1 textarea').forEach(el=>{
      el.classList.remove('invalid');
      if (el.type==='checkbox' || el.type==='radio') el.checked=false; else el.value='';
      if (typeof el.setCustomValidity === 'function') el.setCustomValidity('');
    });
    // Reiniciar “Otros”
    if (cbOtros) cbOtros.checked = false;
    syncOtros();
    setTodayIfEmpty();
  });
</script>
</body>
</html>
